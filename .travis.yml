language: bash

notifications:
  email:
    on_success: change
    on_failure: always

sudo: required

before_install: 
  - export MOR_DIR=$(pwd -P)

  # Install MPICH
  - sudo apt-get update -qq
  - sudo apt-get install -y libmpich-dev mpich

  # Set up Nek5000
  - git clone --single-branch -b presolve-fix https://github.com/kent0/Nek5000
  - export SOURCE_ROOT=$MOR_DIR/Nek5000
  - (cd Nek5000/tools; ./maketools genmap)

before_script:
  - export FC=mpif77
  - export CC=mpicc
  - export FFLAGS="-w -mcmodel=medium"
  - export USR_LFLAGS+="-mcmodel=medium"

script: $MOR_DIR/tests/test.sh

jobs:
    include:
      - stage: unit
        env: TEST=GRAMMIAN_L2_UNIT
      -
        env: TEST=EIGENVECTOR_L2_UNIT
      -
        env: TEST=BASES_L2_UNIT
      -
        env: TEST=INITIAL_CONDITION_L2_UNIT
      -
        env: TEST=A0_L2_UNIT
      -
        env: TEST=B0_L2_UNIT
      -
        env: TEST=C0_L2_UNIT
      -
        env: TEST=GRAMMIAN_H10_UNIT
      -
        env: TEST=EIGENVECTOR_H10_UNIT
      -
        env: TEST=BASES_H10_UNIT
      -
        env: TEST=INITIAL_CONDITION_H10_UNIT
      -
        env: TEST=A0_H10_UNIT
      -
        env: TEST=B0_H10_UNIT
      -
        env: TEST=C0_H10_UNIT

#     - stage: integration
#       env: TEST=BAF_INTEG
